# Configurações do compilador
CC = gcc
CFLAGS = -Wall -Wextra -std=c99 -g
INCLUDES = -I./include
LIBS = -lGL -lGLU -lglut -lm

# Diretórios
SRCDIR = src
BUILDDIR = build
BINDIR = bin
INCLUDEDIR = include

# Nome do executável
TARGET = casa_museu

# Buscar todos os arquivos .c no diretório src
SOURCES = $(wildcard $(SRCDIR)/*.c)
OBJECTS = $(SOURCES:$(SRCDIR)/%.c=$(BUILDDIR)/%.o)

# Regra principal
all: $(BINDIR)/$(TARGET)

# Criar o executável
$(BINDIR)/$(TARGET): $(OBJECTS) | $(BINDIR)
	$(CC) $(OBJECTS) -o $@ $(LIBS)
	@echo "Executável criado: $@"

# Compilar arquivos objeto
$(BUILDDIR)/%.o: $(SRCDIR)/%.c | $(BUILDDIR)
	$(CC) $(CFLAGS) $(INCLUDES) -c $< -o $@
	@echo "Compilado: $<"

# Criar diretórios se não existirem
$(BUILDDIR):
	mkdir -p $(BUILDDIR)

$(BINDIR):
	mkdir -p $(BINDIR)

# Limpeza
clean:
	rm -rf $(BUILDDIR)/*.o
	@echo "Arquivos objeto removidos"

cleanall: clean
	rm -rf $(BINDIR)/$(TARGET)
	@echo "Executável removido"

# Executar o programa
run: $(BINDIR)/$(TARGET)
	cd $(BINDIR) && ./$(TARGET)

# Instalar dependências (Ubuntu/Debian)
install-deps:
	sudo apt-get update
	sudo apt-get install build-essential freeglut3-dev libgl1-mesa-dev libglu1-mesa-dev

# Mostrar informações
info:
	@echo "Projeto: $(TARGET)"
	@echo "Fontes encontradas:"
	@echo "$(SOURCES)"
	@echo "Objetos a serem criados:"
	@echo "$(OBJECTS)"

# Debug - mostrar variáveis
debug:
	@echo "CC: $(CC)"
	@echo "CFLAGS: $(CFLAGS)"
	@echo "INCLUDES: $(INCLUDES)"
	@echo "LIBS: $(LIBS)"
	@echo "SOURCES: $(SOURCES)"
	@echo "OBJECTS: $(OBJECTS)"

# Regras que não são arquivos
.PHONY: all clean cleanall run install-deps info debug

# Dependências dos headers (recompila se algum .h mudar)
$(OBJECTS): $(wildcard $(INCLUDEDIR)/*.h)